## 認識 Continuously Integration

### Continuously Integration

你現在已經了解了如何使用 RSpec 進行自動化測試，也體驗過測試驅動開發的流程。在這個單元裡，我們要更進一步認識軟體工程師如何透過 CI 來進一步進行管理程弍嗎。

CI 的全名是 Continuously Integration，也就是「持續整合」，是現代大型系統開發中的一個觀念。簡單來說，是「持續地」執行自動化測試，在每次修改後，都立刻驗證你的程式是否能運作，並回報結果。

為了要達成續持續整合的目的，你必須建制出覆蓋率足夠的自動化測試，當一個合格的 CI 被建立起來之後，每一次開發完成，到每一次部署，這中間，都不需要工程師再寫任何的程式。

對管理者來說，CI 很適合管理代碼品質，透過 CI 整理代碼品質資訊，呈現在 CI 儀表板上面，你可以很輕鬆地知道最近代碼品質是有所提升，還是正在下降。除此之外，儀表板上也可以粗略的了解工程師在開發專案的進度，以及各個分支開發的狀況。

### CI 在開發流程中的角色

一個導入 CI 的軟體開發流程可能是這樣的：

1. 工程師們把寫好代碼提交到 GitHub 上面
2. 透過 GitHub webhook，通知 CI server 有一批新的代碼剛剛被提交
3. CI server 依照設定好的腳本執行不同任務
4. 將每項任務的結果成功或失敗發送訊息到 Slack，此外，將其他資料傳送到 dashboard
5. 工程師透過 Slack 了解 CI 上的任務執行狀況

從第二個步驟到第四個步驟都算是 CI 涵蓋的範圍。

![CI 流程圖](images/CI-0101.png)


### 工程師日常中的 CI

以下我們舉個例子，來描述一下工程師在日常生活中如何和 CI 互動：

#### 情境 1：佈署前的重要把關

小明是工程師，在中午吃飯之前把代碼推上 GitHub，利用吃飯期間的空檔跑 CI。

吃飯回來之後，小明打開 CI 的結果報告，發現竟然有一個任務 A 還沒跑完測試，小明覺得很奇怪，就打開 CI dashboard 看，發現原來是早上其他部門的工程師發了好幾個測試版本，造成負責執行任務 A 的機器塞車。小明只好耐心地等，又等了半個小時之後，終於輪到小明的任務 A 順利通過。

一旦 CI 跑完測試，確認程式碼品質通過，小明就放心的把代碼部署到機器上。

#### 情境 2：管理程式碼品質

小美是某家公司的 CTO，她閱讀了 CI 輸出的代碼品質月報表，發現這一個月來 iOS app 代碼品質持續下滑，因此她開始詳細研究發生了什麼問題。研究後發現，這幾次的代碼提交，都有部分的功能沒有被撰寫自動化測試。

小美確定結論後，便聯絡 iOS app team 的 leader，請他們在目前的 sprint 結束之後，安排一個禮拜的時間把測試的涵蓋率補到 80%。

### 小結

導入 CI 的優點很多，像是：

- 實現快速迭代的可能性
- 更方便管理代碼複雜度
- 更方便暸解代碼健康程度趨勢
- 減少管理者管理代碼品質的時間

但同時，CI 也會讓整個系統的複雜度提升，並且工程團隊也需要投入一定程度的心力去處理 CI 本身的建構與維護。

下個單元，我們會介紹一些常見的 CI 服務，撰寫給 CI 跑的腳本，最後把 CI 導入你的 Rails 專案。

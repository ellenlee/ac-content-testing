<hr style="border-top: 2px solid #eee">

實作完冷氣開關的功能，是不是覺得利用 TDD 開發其實並沒有想像中這麼遙遠呢？接下來我們要試著從另一個功能出發，搭配 Rails 的 MVC 精神，更熟練測試的抽象概念。

<br>

### 規格

這次要做的是遙控器上的定時按鈕。每按下一次按鈕，會加上一個小時的時間，如果不小心按過頭，就必須先按到定時的最大時數 12 小時，然後從頭開始。

<br>

### Model

在 model 的部分，我們要先確認 `定時` 的功能規格，model 會被分配到負責將冷氣的開啟時間延長一個小時，如果目前的開啟時間為十二個小時，則會把時間歸零。

`用來延長冷氣開啟時間一個小時，不過當目前的開啟時間為十二個小時會把時間歸零`

再來我們要把呼叫這個方法的預期結果也列出來

`預期得到目前冷氣開啟的時間`

呼叫目標功能

`冷氣.定時()`

最後，判斷實際結果等於預期結果

`預期(冷氣.定時()) == 原本的開啟時間加上一小時`

把這四個步驟組合起來，組成 model 的完整測試

<pre style="background:#f9f9f9;color:#080808">測試 "冷氣 定時 回傳值為 六個小時 如果 開啟時間為五個小時" do
    假設 冷氣開啟時間 為 五個小時
    預期(冷氣.定時()) == 六個小時
end

測試 "冷氣 定時 回傳值為 零個小時 如果 開啟時間為十二個小時" do
    假設 冷氣開啟時間 為 十二個小時
    預期(冷氣.定時()) == 零個小時
end
</pre>

<br>

### Controller

首先我們要確認 定時 這個 action 的用途和格式，他是一個 controller 裡面的 action，我們預期他會把冷氣的開啟時間延長一個小時。

`用來延長開啟時間`

再來我們要把呼叫這個方法的預期結果也列出來

`預期呼叫定時之後，過了一個小時，冷氣關機`

呼叫目標功能

`冷氣遙控器.定時()`

最後，判斷實際結果等於預期結果

<pre style="background:#f9f9f9;color:#080808">冷氣遙控器.定時()
59 分鐘過後
預期(冷氣狀態) == 開啟
1 分鐘過後
預期(冷氣狀態) == 關閉
</pre>

<br>

把這四個步驟組合起來，組成 controller 的完整測試

<pre style="background:#f9f9f9;color:#080808">測試 "冷氣遙控器 定時 成功" do
    假設 冷氣開啟
    假設 冷氣開啟時間 未設定
    冷氣遙控器.定時()
    59 分鐘過後
    預期(冷氣狀態) == 開啟
    1 分鐘過後
    預期(冷氣狀態) == 關閉
end
</pre>

<br>

### View

儀表板區域用來顯示目前定時的時間

`儀表板上負責顯示定時時間的區塊正確顯示`

第二步我們要把這個模板預期的結果列出來

<pre style="background:#f9f9f9;color:#080808">當冷氣開啟時間為 n 小時，儀表板上負責顯示定時時間的區塊顯示 n 小時
</pre>

<br>

再來，呼叫模板

`渲染 冷氣遙控器#定時 模板`

最後，判斷實際結果等於預期結果

`預期 儀表板 定時開啟狀態 == "定時 n 小時"`

把這四個步驟組合起來，組成 view 的完整測試

<pre style="background:#f9f9f9;color:#080808">測試 "冷氣遙控器 定時" do
    假設 發送定時指令給冷氣 結果 成功
    冷氣遙控器.定時()
    預期 冷氣遙控器儀表板上 會 顯示 定時 n 小時
end
</pre>

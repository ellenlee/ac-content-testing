<hr style="border-top: 2px solid #eee">

實作完冷氣開關的功能，是不是覺得利用 TDD 開發其實並沒有想像中這麼遙遠呢？

接下來我們要試著從另一個功能出發，搭配 Rails 的 MVC 精神，更熟練測試的抽象概念。

<br>

### 規格

這次要做的是遙控器上的定時按鈕。每按下一次按鈕，會加上一個小時的時間，如果不小心按過頭，就必須先按到定時的最大時數 12 小時，然後從頭開始。

<br>

### Model

在 model 的部分，我們要先確認 `定時` 的功能規格：

* model 會被分配到負責將冷氣的開啟時間延長一個小時，如果目前的開啟時間為十二個小時，則會把時間歸零。
* 我們預期呼叫 `冷氣.定時()` 的時候，會得到「目前冷氣開啟的時間」。

我們會用以下方式來判斷實際結果等於預期結果：

`預期(冷氣.定時()) == 原本的開啟時間加上一小時`

組合成 model 的完整測試案例：

<pre style="background:#f9f9f9;color:#080808">測試</span> <span style="color: #aa5500">&quot;冷氣 定時 回傳值為 六個小時 如果 開啟時間為五個小時&quot;</span> <span style="color: #0000aa">do</span>
  假設 冷氣開啟時間 為 五個小時
  預期(冷氣.定時()) == 六個小時
<span style="color: #0000aa">end</span>

測試</span> <span style="color: #aa5500">&quot;冷氣 定時 回傳值為 零個小時 如果 開啟時間為十二個小時&quot;</span> <span style="color: #0000aa">do</span>
  假設 冷氣開啟時間 為 十二個小時
  預期(冷氣.定時()) == 零個小時
<span style="color: #0000aa">end</span>
</pre>

<br>

### Controller

至於 Controller 的部分，對應到我們相要的功能，在 Controller 應該有一個 `定時` action，這個 action 的用途和格式如下：

* 我們預期他會把冷氣的開啟時間延長一個小時。
* 呼叫 `冷氣遙控器.定時()` 之後，我們預期「過了一個小時，冷氣關機」

我們會用以下方式來判斷實際結果等於預期結果：

<pre style="background:#f9f9f9;color:#080808">冷氣遙控器.定時()
59 分鐘過後
預期(冷氣狀態) == 開啟
1 分鐘過後
預期(冷氣狀態) == 關閉
</pre>

<br>

組成 controller 的完整測試案例：

<pre style="background:#f9f9f9;color:#080808">測試</span> <span style="color: #aa5500">&quot;冷氣遙控器 定時 成功&quot;</span> <span style="color: #0000aa">do</span>
  假設 冷氣開啟
  假設 冷氣開啟時間 未設定
  冷氣遙控器.定時()
  59 分鐘過後
  預期(冷氣狀態) == 開啟
  1 分鐘過後
  預期(冷氣狀態) == 關閉
<span style="color: #0000aa">end</span>
</pre>

<br>

### View

在冷氣遙控器的案例裡，View 對應到遙控器上的儀表板區域，我們希望測試「儀表板上會正確顯示定時時間」，因此，我們預期的結果是：

* 當冷氣開啟時間為 n 小時，儀表板上負責顯示定時時間的區塊顯示 n 小時

我們會用以下方式來呼叫模板：

<pre style="background:#f9f9f9;color:#080808">渲染 <span style="color: #aa5500">&quot;冷氣遙控器#定時&quot;</span> 模板
</pre>

<br>

我們會用以下方式來判斷實際結果等於預期結果：

<pre style="background:#f9f9f9;color:#080808">預期 儀表板 定時開啟狀態 == <span style="color: #aa5500">&quot;定時 n 小時&quot;</span>
</pre>

<br>

把上述設計組合起來，成為 view 的完整測試案例：

<pre style="background:#f9f9f9;color:#080808">測試 <span style="color: #aa5500">&quot;冷氣遙控器 定時&quot;</span> <span style="color: #0000aa">do</span>
  假設 發送定時指令給冷氣 結果 成功
  冷氣遙控器.定時()
  預期 冷氣遙控器儀表板上 會 顯示 定時 n 小時
<span style="color: #0000aa">end</span>
</pre>

以上，我們利用「定時功能」，再次以 model、controller、view 三個層級，討論了如何設計測試案例。在進入到 Rails 實作之前，請你試著想想看，如果輸到你要開發「調高溫度」功能，你會怎麼思考？
